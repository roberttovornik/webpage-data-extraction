var poll=function(){"use strict";function t(){}function e(t,e){for(var n in e)t[n]=e[n];return t}function n(t){t()}function s(t,e){t.appendChild(e)}function r(t,e,n){t.insertBefore(e,n)}function o(t){t.parentNode.removeChild(t)}function a(t,e){for(var n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function i(t){return document.createElement(t)}function l(t){return document.createTextNode(t)}function c(t,e,n){t.addEventListener(e,n,!1)}function d(t,e,n){t.removeEventListener(e,n,!1)}function h(t,e){t.data=""+e}function u(t,e,n){t.style.setProperty(e,n)}function f(){return Object.create(null)}function p(t){t._lock=!0,_(t._beforecreate),_(t._oncreate),_(t._aftercreate),t._lock=!1}function _(t){for(;t&&t.length;)t.shift()()}var m={destroy:function(e){this.destroy=t,this.fire("destroy"),this.set=t,this._fragment.d(!1!==e),this._fragment=null,this._state={}},get:function(){return this._state},fire:function(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var s=0;s<n.length;s+=1){var r=n[s];if(!r.__calling)try{r.__calling=!0,r.call(this,e)}finally{r.__calling=!1}}},on:function(t,e){var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}},set:function(t){this._set(e({},t)),this.root._lock||p(this.root)},_recompute:t,_set:function(t){var n=this._state,s={},r=!1;for(var o in t=e(this._staged,t),this._staged={},t)this._differs(t[o],n[o])&&(s[o]=r=!0);r&&(this._state=e(e({},n),t),this._recompute(s,this._state),this._bind&&this._bind(s,this._state),this._fragment&&(this.fire("state",{changed:s,current:this._state,previous:n}),this._fragment.p(s,this._state),this.fire("update",{changed:s,current:this._state,previous:n})))},_stage:function(t){e(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:function(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}};var g={getData(){let t=document.getElementById("poll-widget"),e=t.getAttribute("data-poll-id"),n=parseInt(t.getAttribute("data-section-id"));var s=this,r=Math.floor(99999*Math.random()+1),o="";if(a=!1,parseInt(e,10)){var a=!0;o="getPollById??client_id=8b6950d87f5b94fc8ee5227d036d27f3&id="+parseInt(e,10)}else o="getPoll?client_id=8b6950d87f5b94fc8ee5227d036d27f3&sectionId="+parseInt(n,10);var i=new Request("https://api.rtvslo.si/poll/"+o+"&c="+r,{method:"GET",mode:"cors"});fetch(i).then(function(t){return t.json()}).catch(function(t){}).then(t=>{console.log(t);new DOMParser;if(t){var n=0;if(a){t.response.answers.map(t=>{n+=parseInt(t.times,10)});var r=t.response.answers.map(t=>(t.procentage=parseFloat((100*t.times/n).toFixed(0)),t));s.set({pollId:parseInt(e,10),question:t.response.question})}else{t.response.poll.answers.map(t=>{n+=parseInt(t.times,10)});r=t.response.poll.answers.map(t=>(t.procentage=parseFloat((100*t.times/n).toFixed(0)),t));s.set({pollId:t.response.poll.id,question:t.response.poll.question})}if(s.set({answers:r,allVotes:n}),a)var o=localStorage.getItem("POLL"+parseInt(e,10));else o=localStorage.getItem("POLL"+t.response.poll.id);o&&s.set({hasVoted:!0})}})},vote(){const{pollId:t,answerId:e}=this.get();var n=this,s=new Request("https://api.rtvslo.si/poll/votePoll?client_id=8c5205a95060a482f0fc96b9162d9e3f",{method:"POST",body:"&pollId="+t+"&answerId="+e,headers:{"Content-Type":"application/json"}});fetch(s).then(function(t){return t.json()}).catch(function(t){}).then(e=>{e&&(console.log("the data",e),localStorage.setItem("POLL"+t,!0),n.set({hasVoted:!0}),n.getData())})},selectedAnswer(t){console.log(t),this.set({answerId:t})}};function v(t){const{component:e,ctx:n}=this._svelte;e.selectedAnswer(n.answer.id)}function w(t,e,n){const s=Object.create(t);return s.answer=e[n],s.each_value_1=e,s.answer_index_1=n,s}function b(t,e,n){const s=Object.create(t);return s.answer=e[n],s.each_value=e,s.answer_index=n,s}function I(t,e){for(var n,h,u,f,p=e.answers,_=[],m=0;m<p.length;m+=1)_[m]=N(t,w(e,p,m));function g(e){t.vote()}return{c(){n=i("div");for(var t=0;t<_.length;t+=1)_[t].c();h=l("\n\t\t"),u=i("div"),(f=i("button")).textContent="Pošlji",n.className="poll-options",c(f,"click",g),f.className="btn btn-sm btn-section-color",f.type="button",u.className="text-center poll-footer"},m(t,e){r(t,n,e);for(var o=0;o<_.length;o+=1)_[o].m(n,null);r(t,h,e),r(t,u,e),s(u,f)},p(e,s){if(e.answers||e.pollId){p=s.answers;for(var r=0;r<p.length;r+=1){const o=w(s,p,r);_[r]?_[r].p(e,o):(_[r]=N(t,o),_[r].c(),_[r].m(n,null))}for(;r<_.length;r+=1)_[r].d(1);_.length=p.length}},d(t){t&&o(n),a(_,t),t&&(o(h),o(u)),d(f,"click",g)}}}function y(t,e){for(var n,c,d,u,f,p=e.answers,_=[],m=0;m<p.length;m+=1)_[m]=x(t,b(e,p,m));return{c(){n=i("div");for(var t=0;t<_.length;t+=1)_[t].c();c=l("\n\t\t"),d=i("p"),u=l("Število glasov: "),f=l(e.allVotes),n.className="poll-answers",d.className="text-center poll-footer"},m(t,e){r(t,n,e);for(var o=0;o<_.length;o+=1)_[o].m(n,null);r(t,c,e),r(t,d,e),s(d,u),s(d,f)},p(e,s){if(e.answers){p=s.answers;for(var r=0;r<p.length;r+=1){const o=b(s,p,r);_[r]?_[r].p(e,o):(_[r]=x(t,o),_[r].c(),_[r].m(n,null))}for(;r<_.length;r+=1)_[r].d(1);_.length=p.length}e.allVotes&&h(f,s.allVotes)},d(t){t&&o(n),a(_,t),t&&(o(c),o(d))}}}function N(t,e){var n,a,u,f,p,_,m,g,w,b=e.answer.answer;return{c(){var s,r;n=i("div"),a=i("input"),_=l("\n\t\t\t\t"),m=i("label"),g=l(b),a._svelte={component:t,ctx:e},c(a,"click",v),a.className="form-check-input",s="type",r="radio",a.setAttribute(s,r),a.name=u="radio-choice-v-"+e.pollId,a.id=f="radio-choice-v-"+e.answer.id,a.value=p=e.answer.id,m.className="form-check-label",m.htmlFor=w="radio-choice-v-"+e.answer.id,n.className="form-check"},m(t,e){r(t,n,e),s(n,a),s(n,_),s(n,m),s(m,g)},p(t,n){e=n,a._svelte.ctx=e,t.pollId&&u!==(u="radio-choice-v-"+e.pollId)&&(a.name=u),t.answers&&f!==(f="radio-choice-v-"+e.answer.id)&&(a.id=f),t.answers&&p!==(p=e.answer.id)&&(a.value=p),t.answers&&b!==(b=e.answer.answer)&&h(g,b),t.answers&&w!==(w="radio-choice-v-"+e.answer.id)&&(m.htmlFor=w)},d(t){t&&o(n),d(a,"click",v)}}}function x(t,e){var n,a,c,d,f,p,_,m,g,v,w=e.answer.procentage,b=e.answer.answer;return{c(){n=i("div"),a=i("div"),c=l(w),d=l("%"),f=l("\n\t\t\t\t"),p=i("div"),_=i("span"),m=l(b),g=l("\n\t\t\t\t\t"),v=i("span"),a.className="percent",v.className="percent-bg-bar",u(v,"width",e.answer.procentage+"%"),p.className="answer",n.className="poll-answer"},m(t,e){r(t,n,e),s(n,a),s(a,c),s(a,d),s(n,f),s(n,p),s(p,_),s(_,m),s(p,g),s(p,v)},p(t,e){t.answers&&w!==(w=e.answer.procentage)&&h(c,w),t.answers&&b!==(b=e.answer.answer)&&h(m,b),t.answers&&u(v,"width",e.answer.procentage+"%")},d(t){t&&o(n)}}}function q(t){!function(t,e){t._handlers=f(),t._slots=f(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}(this,t),this._state=e({pollId:"",data:{},question:"",answers:[],answerId:"",hasVoted:!1,allVotes:0},t.data),this._intro=!!t.intro,this._fragment=function(t,e){var a,c,d,u,f,p,_;function m(t){return t.hasVoted?y:I}var g=m(e),v=g(t,e);return{c(){a=i("div"),(c=i("h3")).textContent="Anketa",d=l("\n\t\t"),u=i("p"),f=l(e.question),p=l("\n\t\t"),v.c(),c.className="poll-title",u.className="poll-question",a.className="poll-box"},m(t,e){r(t,a,e),s(a,c),s(a,d),s(a,u),s(u,f),s(a,p),v.m(a,null),_=!0},p(e,n){e.question&&h(f,n.question),g===(g=m(n))&&v?v.p(e,n):(v.d(1),(v=g(t,n)).c(),v.m(a,null))},i(t,e){_||this.m(t,e)},o:n,d(t){t&&o(a),v.d()}}}(this,this._state),this.root._oncreate.push(()=>{(function(){this.getData()}).call(this),this.fire("update",{changed:function(t,e){for(var n in e)t[n]=1;return t}({},this._state),current:this._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),p(this)),this._intro=!0}return e(q.prototype,m),e(q.prototype,g),new q({target:document.querySelector("#poll-widget"),data:{showModal:!1}})}();
